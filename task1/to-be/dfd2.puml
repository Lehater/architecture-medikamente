@startuml
title DFD #2: Ведение медицинской карты и учёт анализов + Меры безопасности

actor "Врач" as Doctor
actor "Пациент" as Patient
rectangle "Лаборатория анализов\n(Внешняя система)" as Lab
database "Медицинская карта\n(Excel/PDF/Сканы)\n[TAG: PHI]" as MedRecord

' Пациент предоставляет данные врачу
Patient --> Doctor: Передаёт медицинскую информацию\n(жалобы, история болезни)
note right: Данные помечены как PHI (защищённые данные)

' Врач заполняет медицинскую карту
Doctor --> MedRecord: Создание/обновление записи\n(диагноз, рекомендации)
note left of MedRecord
Меры безопасности:
- Шифрование при хранении (БД/файлы)
- Ограничение доступа: RBAC (доступ только для врачей/уполномоченных)
- Логирование операций доступа
- Тег: PHI
end note

' Врач направляет пациента на анализы
Doctor --> Lab: Отправляет запрос\n(идентификатор пациента)
note on link
Передача через защищённый канал (TLS/VPN)
end note

' Лаборатория возвращает результаты анализов
Lab --> Doctor: Возвращает результаты\n(в зашифрованном виде)
note on link
Результаты помечаются как PHI
end note

' Врач обновляет медицинскую карту результатами анализов
Doctor --> MedRecord: Обновление записи\n(добавление результатов анализов)
@enduml